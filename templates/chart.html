<!doctype html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="{{url_for('static', filename='test.js')}}"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body >
  
  
  <div>
    
    <nav class="navbar sticky-top navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <img src="static\img\logo-CX ABSIDE-DEF.png" alt="" width="30" height="24" class="d-inline-block align-text-top">
          Customer Experience
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link " aria-current="page" href="/">Subir archivo</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link active dropdown-toggle" href="/chart" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Reportes
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li><a class="dropdown-item" href="/chart">CDC</a></li>
                <li><a class="dropdown-item" href="/chart">Consultoria</a></li>
                <li><a class="dropdown-item" href="/chart">Proceso comercial</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  
    <!--Salto de linea-->
    <br>
    
    <!--Form/selects-->
    <div style="align-items:center;justify-content:center;display:flex">
      
      <form method = "get" class="row gy-2 gx-3 align-items-center">

          <div class="col-sm-2"> 

            {% if cliente_input  != "Todos" and cliente_input %}
              <select id="trimestre_input" name="trimestre_input" class="form-select" >
            
            {% else %}
              <select id="trimestre_input" name="trimestre_input" class="form-select" disabled>
            
            {% endif %}

             {% for Trimestre in Trimestres %}
                {% if Trimestre == trimestre_input %}
                  <option value="{{Trimestre}}" selected="selected">Q{{ Trimestre}}</option>
                {% else %}
                  <option value="{{Trimestre}}">Q{{ Trimestre}}</option>  
                {% endif %}
             {% endfor %}   
            </select>

           </div>  
                         
        <div class="col-sm-2">   
          <select id="year_input" name="year_input" class="form-select" >
           {% for Year in Years %}
            <option value="{{Year}}" >{{ Year}}</option>
           {% endfor %}   
           </select>
        </div>

        <div class="col-sm-2">
          <select id="cliente_input" name="cliente_input" class="form-select" onchange="changeSelect()">
            <option value="Todos" default>Todos</option>
           {% for cliente in lista_clientes %}
            {% if cliente == cliente_input%}
              <option value="{{cliente}}" selected="selected">{{cliente}}</option>
            {% else %}
              <option value="{{cliente}}" >{{cliente}}</option>
            {% endif %}
           {% endfor %}   
           </select>
        </div>

        <div class="col-sm-2">
          <div class="form-check">
            <input class="btn btn-dark" type=submit value="Filtrar">
          </div>
        </div>

      </form>
    </div>

    <br>

    <!--SHOW TABLE-->
    {% if not cliente_unico %}
    
    <div style="align-items:center;justify-content:center;display:flex">
      <p class="text-center align-self-center fst-italic">Q1: {{avg_q1}} Q2: {{avg_q2}} Q3: {{avg_q3}} Q4: {{avg_q4}}</p>
    </div>
            <table class="table table-striped table-sm table-bordered">
              <thead class="table-dark">
                <tr>
                  {% for i in range(4) %}
                    {% if i == 0 %}
                      <th scope="col">Nombre</th>
                    {% endif %} 
                      <th scope="col">Trimestre</th>
                      <th scope="col">VA</th>
                      <th scope="col">CSAT</th>
                      <th scope="col">NPS</th>
                      <th scope="col">CES</th>
                      <th scope="col">General</th>
                    {% endfor %}
                </tr>  
              </thead>

              <tbody>

                {%for doc in kpi_q1 %}
                <tr>
                  <td>{{doc['Cliente']}}</td>
                  <th scope="row">Q{{doc['Trimestre']}}</td>
                  <td>{{doc['kpi_valor']}}</td>
                  <td>{{doc['kpi_satisfaccion']}}</td>
                  <td>{{doc['kpi_lealtad']}}</td>
                  <td>{{doc['kpi_esfuerzo']}}</td>
                  <td>{{doc['kpi_total']}}</td>

                  <th scope="row">Q{{kpi_q2[loop.index-1]['Trimestre']}}</th>
                  <td>{{kpi_q2[loop.index-1]['kpi_valor']}}</td>
                  <td>{{kpi_q2[loop.index-1]['kpi_satisfaccion']}}</td>
                  <td>{{kpi_q2[loop.index-1]['kpi_lealtad']}}</td>
                  <td>{{kpi_q2[loop.index-1]['kpi_esfuerzo']}}</td>
                  <td>{{kpi_q2[loop.index-1]['kpi_total']}}</td>
  
                  <th scope="row">Q{{kpi_q3[loop.index-1]['Trimestre']}}</th>
                  <td>{{kpi_q3[loop.index-1]['kpi_valor']}}</td>
                  <td>{{kpi_q3[loop.index-1]['kpi_satisfaccion']}}</td>
                  <td>{{kpi_q3[loop.index-1]['kpi_lealtad']}}</td>
                  <td>{{kpi_q3[loop.index-1]['kpi_esfuerzo']}}</td>
                  <td>{{kpi_q3[loop.index-1]['kpi_total']}}</td>

                  <th scope="row">Q{{kpi_q4[loop.index-1]['Trimestre']}}</th>
                  <td>{{kpi_q4[loop.index-1]['kpi_valor']}}</td>
                  <td>{{kpi_q4[loop.index-1]['kpi_satisfaccion']}}</td>
                  <td>{{kpi_q4[loop.index-1]['kpi_lealtad']}}</td>
                  <td>{{kpi_q4[loop.index-1]['kpi_esfuerzo']}}</td>
                  <td>{{kpi_q4[loop.index-1]['kpi_total']}}</td>
                </tr>
                
                {% endfor %}   
              </tbody>
            </table>

            {% endif %}
      
      <!--SHOW SPEEDMETER-->

      {% if  cliente_unico %}

      {% if  kpi_total == 0 %}
      
      <p class="text-center align-self-center fst-italic">No hay informaci√≥n registrada para este cliente en el trimestre buscado</p>
      
      {% else %}

      <h3 style="text-align:center">Valor General :{{kpi_total}}</h3>
      
      <div class="container">
        <div class="row row-cols-2">
          <div class="col" id="bargraph1">
            <script>
                var graphs1 = {{graphJSON_esfuerzo | safe}};
                Plotly.plot('bargraph1',graphs1,{});
            </script>
          </div>
          <div class="col" id="bargraph2">
            <script>
                var graphs2 = {{graphJSON_satisfaccion | safe}};
                Plotly.plot('bargraph2',graphs2,{});
            </script>
          </div>
        </div>
        <div class="row row-cols-2">
          <div class="col" id="bargraph3">
            <script>
                var graphs3 = {{graphJSON_lealtad | safe}};
                Plotly.plot('bargraph3',graphs3,{});
            </script>
          </div>
          <div class="col" id="bargraph4">
            <script>
                var graphs4 = {{graphJSON_valor | safe}};
                Plotly.plot('bargraph4',graphs4,{});
            </script>
          </div>
        </div>
      </div>
       
      {% endif %}
      {% endif %}
    </div>
</body>
